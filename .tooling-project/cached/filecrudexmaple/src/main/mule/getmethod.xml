<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:validation="http://www.mulesoft.org/schema/mule/validation" xmlns:vm="http://www.mulesoft.org/schema/mule/vm"
	xmlns:os="http://www.mulesoft.org/schema/mule/os"
	xmlns:file="http://www.mulesoft.org/schema/mule/file" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/file http://www.mulesoft.org/schema/mule/file/current/mule-file.xsd
http://www.mulesoft.org/schema/mule/os http://www.mulesoft.org/schema/mule/os/current/mule-os.xsd
http://www.mulesoft.org/schema/mule/vm http://www.mulesoft.org/schema/mule/vm/current/mule-vm.xsd
http://www.mulesoft.org/schema/mule/validation http://www.mulesoft.org/schema/mule/validation/current/mule-validation.xsd">
	<configuration-properties doc:name="Configuration properties" doc:id="dc61ef7e-7dd9-48ad-ae4d-aef3f508bf2c" file="conf/local.yaml" />
	<file:config name="File_Config" doc:name="File_Config" doc:id="51616d26-038c-4b54-a430-b1a64d51a4be">
		<file:connection workingDir="#[p('app.directory')]"/>
	</file:config>
	<sub-flow name="getSubFlow" doc:id="36370550-b828-4987-b6e2-3c7e79eacd61" >
		<set-variable value="#[import modules::GetMethod
---
GetMethod::getWrongKeys(payload)]" doc:name="Set Wrong Keys" doc:id="96501a81-3e50-4622-b764-c5c08b813239" variableName="wrongKeys"/>
		<choice doc:name="Choice" doc:id="1db73cd4-1354-4510-9daf-e26b499c2f2a" >
			<when expression="#[vars.wrongKeys != []]">
				<raise-error doc:name="Raise error" doc:id="51616d26-038c-4b54-a430-b1a64d51a4be" type="VALIDATION:INVALID_KEYS" description='#["Fields found in parameter list not supported by GetMethod: [" ++ (vars.wrongKeys joinBy ", ") ++ "]"]'/>
			</when>
		</choice>
		<set-variable value="#[{
	id: payload.id default null,
	model: payload.model default null,
	mark: payload.mark default null,
	yearFrom: payload.yearFrom as Date default null,
	yearTo: payload.yearTo as Date default null,
	priceFrom: payload.priceFrom as Number default null,
	priceTo: payload.priceTo as Number default null
}]" doc:name="params" doc:id="74b6e98f-39f1-42b2-be31-e93a95127b88" variableName="params" />
		<file:read doc:name="Read JSON File" doc:id="3adfc6ac-5eb0-4e58-a6ad-002e5764513e" config-ref="File_Config" path="#[p('app.json_file_path')]"/>
		<set-payload value='#[import modules::GetMethod
output application/json
---
GetMethod::getByProperties(payload as Array, vars.params as Object)]' doc:name="Set Payload" doc:id="54fca21b-d55b-40fe-8aa2-4e55df7e5d6d" />
	</sub-flow>
</mule>
